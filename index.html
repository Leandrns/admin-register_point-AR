<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Registro de Ponto AR Persistente</title>
    <script src="https://aframe.io/releases/1.7.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
  </head>
  <body style="margin: 0; overflow: hidden;">
    <button id="registerBtn" style="position: fixed; top: 10px; left: 10px; z-index: 2;">
      Registrar Ponto
    </button>

    <a-scene embedded arjs="sourceType: webcam; debugUIEnabled: false;">
      <!-- Marcador de referência -->
      <a-marker preset="hiro" id="marker">
        <a-box position="0 0.5 0" material="color: red;"></a-box>
      </a-marker>

      <!-- Container para pontos fixos -->
      <a-entity id="pontos"></a-entity>

      <!-- Câmera -->
      <a-entity camera></a-entity>
    </a-scene>

    <script>
      const pontosEl = document.getElementById("pontos");
      const pontosRegistrados = [];

      document.getElementById("registerBtn").addEventListener("click", () => {
        const marker = document.getElementById("marker");

        if (marker.object3D.visible) {
          // Pega a posição e rotação do marcador no mundo
          const pos = new THREE.Vector3();
          const quaternion = new THREE.Quaternion();
          marker.object3D.getWorldPosition(pos);
          marker.object3D.getWorldQuaternion(quaternion);

          const rot = new THREE.Euler();
          rot.setFromQuaternion(quaternion);

          // Salva em memória
          pontosRegistrados.push({ x: pos.x, y: pos.y, z: pos.z, rotY: rot.y });

          // Cria esfera no espaço global
          const sphere = document.createElement("a-sphere");
          sphere.setAttribute("radius", "0.1");
          sphere.setAttribute("color", "blue");
          sphere.setAttribute("position", `${pos.x} ${pos.y} ${pos.z}`);
          // pontosEl.appendChild(sphere);
          document.querySelector('a-scene').appendChild(sphere);


          console.log("Ponto registrado:", pontosRegistrados);
        } else {
          alert("Aponte a câmera para o marcador Hiro para registrar.");
        }
      });
    </script>
  </body>
</html>
